
 <!DOCTYPE html> 
<html>
  <head>
    <title>Is It Sunny?</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
	<script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
	<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
	<script>	  
	// Declared Funtions
	  // Places Constructor function -> will create an object for each location and add the object to an array.
	  function Places (name, latitude, longitude, array){
		this.name = name;
		this.latitude = latitude;
		this.longitude = longitude;
		this.spot = {};
		this.spot.lat = latitude;
		this.spot.lng = longitude;
		array.push(this);
	  }
	  // Button Maker function -> will create a button for every place object we please.
	  function buttonMaker(place){
		var button = document.createElement('button');
		button.id = place.name;
		button.value = place.name;
		var buttonText = document.createTextNode(place.name);
		button.appendChild(buttonText);
		sidebar.appendChild(button);
	  }
	   // Make Buttons function -> calls Button Maker function in every element in a give array (we use the array where we stored our places objects).
	  function makeButtons(array){
		for(var i = 0; i < array.length; i++){
			buttonMaker(array[i]);
		}
	  }

	  // Declared Variables
	  //  A Container div -> to hold all elements in our html page.
      var container = document.createElement('div');
	  container.id = 'container';
	  container.style.width = "100%";
	  container.style.height = "2000px";
	  var title = document.createElement('h2');
	  title.id = "title";
	  title.innerHTML = "Rio de Janeiro";
	  container.appendChild(title);
	  // A Sidebar div -> holds our buttons, search bar and logo.
	  var sidebar = document.createElement('div');
	  sidebar.id = 'sidebar';
	  sidebar.style.width = "75px";
	  sidebar.style.backgroundColor = "#00ff48";
	  sidebar.style.height = "100%";
	  sidebar.style.float = "left";
	  sidebar.style.margin = "0";
	  sidebar.style.padding = "0";
	  sidebar.style.float = "left";
	  container.appendChild(sidebar);
	  // A Results div -> holds results for the current moment.
	  var results = document.createElement("table");
	  results.id = "results";
	  results.style.float = "left";
	  container.appendChild(results);
	  // A Future Results div -> holds results for the future moments.
	  var futureResults = document.createElement("table");
	  futureResults.id = "futureResults";
	  // Create an array to hold all of our Google Maps Markers.
	  var markers = [];
	  // Create the Places array -> where we will store all of our places' objects.
	  var places = [];
	  var urca = new Places('Urca', -22.955430, -43.164800, places);
	  var copa = new Places('Copa', -22.9689662, -43.1844084, places);
	  var ipanema = new Places('Ipanema', -22.986450, -43.205995, places);
	  var leblon = new Places('Leblon', -22.987649, -43.221640, places);
	  var sanca = new Places('Sanca', -22.999373, -43.264027, places);
	  var joatinga = new Places('Joatinga', -23.014354, -43.290364, places);
	  var barra = new Places('Barra', -23.012240, -43.323770, places);
	  var reserva = new Places('Reserva', -23.012849, -43.388988, places);
	  var macumba = new Places('Macumba', -23.033037, -43.4862847, places);  
	  var recreio = new Places('Recreio', -23.028383, -43.464918, places);
	  var prainha = new Places('Prainha', -23.040962, -43.505379, places);
	  var grumari = new Places('Grumari', -23.048466, -43.524417, places);
	  var guaratiba = new Places('Guaratiba', -23.067656, -43.567932, places);

	  // Wiring Things Together
	   // A jQuery function -> when document has loaded this function runs.
	  $(document).ready(function(){
		// Here we call the Make Buttons function giving it our Places array. 
		makeButtons(places);

		(function createInitialTable (){
			// Next, we declare all the variables we'll need for the API call
			// 	- The API key, Latitude and Longitude are necessary for the API's URL.
			var APIKEY = "e964d33cde30c141523b46f7f27e0007";
			var LATITUDE = -22.986450;
			var LONGITUDE = -43.205995;
			// Here we generate a simple title.
		//	container.innerHTML += '<h2 align="center">' + "Rio de Janeiro"+ "</h2>";
			// Here we declare our API's variable -> it is simply a string holding the API's url and our variables are concatenated into it. 
			var weatherAPI = "https://api.forecast.io/forecast/" + APIKEY + "/" + LATITUDE + "," + LONGITUDE + "?callback=?";
			// Finally, we have our callback function -> it takes in our data (JSON data that gets returned from the API request) and displays it to our webpage as a table.
			function displayWeather(data){
				results.innerHTML += "<th>Currently</th>";
				results.innerHTML += "<td>Summary:  " + data.currently.summary + "</td>";
				results.innerHTML += "<td>Temperature:  " + data.currently.temperature + " ºF </td>";
				results.innerHTML += "<td>Wind Speed:  " + data.currently.windSpeed + " mpf </td>";
				results.innerHTML += "<td>Chance of Rain:  " + Math.round(data.currently.precipProbability * 100) + "% </td>";
				results.innerHTML += "<td>Humidity:  " + data.currently.humidity * 100 + "% </td>";
				results.innerHTML += "<td>Pressure:  " + data.currently.pressure + " mb </td>";
			}	
			// Lastly, our jQuery .getJSON method manages our API request taking in our URL and callback function.
			$.getJSON(weatherAPI, displayWeather);	
			// Add our Results div to our Container div and effectively	display our results.
			container.appendChild(results);
				// The chunk of code below will get the current time in Rio in UNIX time (seconds since Jan 1st 1970). 
				var timeNow = Date.now();
				timeNow /= 1000;
				timeNow -= (86400 / 24) * 3;
				// The Next Time variable will add 12 hours to the timeNow variable
				var nextTime = timeNow + 43200;
				// The Time variable is the one that will be used in the API call, the Math.round method rounds our number to it's nearest whole number.
				var TIME = Math.round(nextTime);
				// The Time Intervals will be of 12 hours
				var INTERVAL = 12;

				futureResults.innerHTML += "<th>Moment</th><th>Summary</th><th>Temperature</th><th>Wind Speed</th><th>Chance of Rain</th><th>Humidity</th><th>Pressure</th>";
				// Lastly, we have a for loop that will print our results for the next 10 12-hour intervals.
				for (var i = 1; i <= 10; i++){
					loopFutureResults(APIKEY, LATITUDE, LONGITUDE, TIME, INTERVAL);
					TIME += 43200;
					INTERVAL += 12;	

				}

				// This function will called by the for loop in the futureResults func.
			function loopFutureResults(APIKEY, LATITUDE, LONGITUDE, TIME, INTERVAL){
					var weatherAPI = "https://api.forecast.io/forecast/" + APIKEY + "/" + LATITUDE + "," + LONGITUDE + "," + TIME + "?callback=?";
		
					function displayWeather(data){
							
							futureResults.innerHTML += "<td>" + "In " + INTERVAL + " hours" + "</td><td>" + data.currently.summary + "</td><td>" + data.currently.temperature + " ºF </td><td>" + data.currently.windSpeed + " mph </td><td>" + Math.round(data.currently.precipProbability * 100) + "% </td><td>" + Math.round(data.currently.humidity * 100) + "% </td><td>" + data.currently.pressure + " mb </td>";
							futureResults.innerHTML += "</tr>";
							} 

				$.getJSON(weatherAPI, displayWeather);	
						
				container.appendChild(futureResults);	
			}
			
		})();
		
		// Another jQuery function -> when any button is clicked a table is created and the CURRENT weather conditions are displayed:
		// - This is our API call to receive our current results.
		$("body").on('click', 'button', function resultsFunc(){
			// First we clear our Results div -> so that when we call it a second time, our first results disappear.
			// resultsContainer.innerHTML = " ";

			results.innerHTML = " ";
			futureResults.innerHTML = " ";
			// Next, we declare all the variables we'll need for the API call
			// 	- The API key, Latitude and Longitude are necessary for the API's URL.
			var APIKEY = "e964d33cde30c141523b46f7f27e0007";
			var LATITUDE;
			var LONGITUDE;
			//  - The Button Value variable will get (via jQuery) the text for each button and will ube used as the title for our results.
			var btnValue = $(this).text();
			// This 'for' loop will go over the places array and check if our Button's text value matches any of our places' names. If so it will set our Latitude and Longitude varibles as the Latitude and Longitude of the matched object.
			for(var i = 0; i < places.length; i++){
				if(btnValue == places[i]["name"]){
					LATITUDE = places[i]["latitude"];
					LONGITUDE = places[i]["longitude"];
				}		
			}
			// Here we declare our API's variable -> it is simply a string holding the API's url and our variables are concatenated into it. 
			var weatherAPI = "https://api.forecast.io/forecast/" + APIKEY + "/" + LATITUDE + "," + LONGITUDE + "?callback=?";
			// Finally, we have our callback function -> it takes in our data (JSON data that gets returned from the API request) and displays it to our webpage as a table.
			function displayWeather(data){
				title.innerHTML = btnValue;
				results.innerHTML += "<th>Currently</th>";
				results.innerHTML += "<td>Summary:  " + data.currently.summary + "</td>";
				results.innerHTML += "<td>Temperature:  " + data.currently.temperature + " ºF </td>";
				results.innerHTML += "<td>Wind Speed:  " + data.currently.windSpeed + " mpf </td>";
				results.innerHTML += "<td>Chance of Rain:  " + data.currently.precipProbability * 100 + "% </td>";
				results.innerHTML += "<td>Humidity:  " + data.currently.humidity * 100 + "% </td>";
				results.innerHTML += "<td>Pressure:  " + data.currently.pressure + " mb </td>";

			}	
			// Lastly, our jQuery .getJSON method manages our API request taking in our URL and callback function.
			$.getJSON(weatherAPI, displayWeather);	
			// Add our Results div to our Container div and effectively	display our results.
			container.appendChild(results);

				// The chunk of code below will get the current time in Rio in UNIX time (seconds since Jan 1st 1970). 
				var timeNow = Date.now();
				timeNow /= 1000;
				timeNow -= (86400 / 24) * 3;
				// The Next Time variable will add 12 hours to the timeNow variable
				var nextTime = timeNow + 43200;
				// The Time variable is the one that will be used in the API call, the Math.round method rounds our number to it's nearest whole number.
				var TIME = Math.round(nextTime);
				// The Time Intervals will be of 12 hours
				var INTERVAL = 12;
				var TITLE = btnValue;

				futureResults.innerHTML += "<th>Moment</th><th>Summary</th><th>Temperature</th><th>Wind Speed</th><th>Chance of Rain</th><th>Humidity</th><th>Pressure</th>";
				// Lastly, we have a for loop that will print our results for the next 10 12-hour intervals.
				for (var i = 1; i <= 10; i++){
					loopFutureResults(APIKEY, LATITUDE, LONGITUDE, TIME, INTERVAL, TITLE);
					TIME += 43200;
					INTERVAL += 12;	

				}

				// This function will called by the for loop in the futureResults func.
			function loopFutureResults(APIKEY, LATITUDE, LONGITUDE, TIME, INTERVAL, TITLE){
					var weatherAPI = "https://api.forecast.io/forecast/" + APIKEY + "/" + LATITUDE + "," + LONGITUDE + "," + TIME + "?callback=?";
		
					function displayWeather(data){
							
							futureResults.innerHTML += "<td>" + "In " + INTERVAL + " hours" + "</td><td>" + data.currently.summary + "</td><td>" + data.currently.temperature + " ºF </td><td>" + data.currently.windSpeed + " mph </td><td>" + Math.round(data.currently.precipProbability * 100) + "% </td><td>" + Math.round(data.currently.humidity * 100) + "% </td><td>" + data.currently.pressure + " mb </td>";
							futureResults.innerHTML += "</tr>";
							} 

				$.getJSON(weatherAPI, displayWeather);	
						
				container.appendChild(futureResults);	
			}
			});
			
   		document.body.appendChild(container);
  	  });
		
	</script>

	<!-- STYLES PROVIDED BY GOOGLE MAPS API -->
	<style>
	      html, body {
	        height: 100%;
	        margin: 0;
	        padding: 0;
	      }
	      button {
	      	margin: 3px 3px 3px 3px;
	      	text-align: center;

	      }
	      #map {
	        height: 250px;
	       	margin: 5px;
	        width: 90%;
	        float: left;
	      }
	     table, th, td {
			border: 1px solid black;
			border-collapse: collapse;;
		 }
		 table {
			margin: 8px;
			align: center;
		 }
		 th {
			padding: 5px;
			}
		 td, h2 {
		 	text-align: center;
		 }
		#results {
			font-size: 1.4em;
		}

	</style>
  </head>
	  <body>
		<!-- This div will hold our Google Maps map. -->
	    <div id="map"></div>
	    <!-- The Google Maps API instructs us to create the following script tags-->
	    <script>
	    //Create a Google Maps Map and place it inside the map div.
	      var map;
	      function initMap() {
	        map = new google.maps.Map(document.getElementById('map'), {
	          center: {lat:-22.98, lng: -43.26},
	          zoom: 12
	        });    
	    // This for loop will loop over the places array and create a Google Maps marker for each of our objects: The marker's title will be the place's name, the position will be the place's spot(a LatLng object) and it's label/id will be the first character in their name.
	    for(var i = 0; i < places.length; i++){
	        	var name = places[i]["name"];
	        	var label = name.charAt(0);
	        	 var marker = new google.maps.Marker({
				    position: places[i]["spot"],
				    map: map,
				    title: name,
				    id : label,
				    label: label,
				    animation: google.maps.Animation.DROP
		  		});
	        	// When a marker is clicked, the map will zoom into it's location.
		  		marker.addListener('click', function() {
					map = marker.getMap();
					map.setZoom(16);
					map.setCenter(this.getPosition());
					});
		  		// When a marker is dbl-clicked, the map will zoom out and back to it's original position.
				marker.addListener('dblclick', function() {
					map = marker.getMap();
					map.setZoom(12);
					map.setCenter({lat:-22.98, lng: -43.26});
					});
				// Here we push our marker into our Markers array as an array with 2 elements: the marker itself and it's name.
				markers.push([marker, places[i]["name"]]);
	        } // End of for loop.
	    } // End of initMap function.

    	// Add map to our Container div.
        container.appendChild(document.getElementById('map'));
	    </script>
	    <!-- This script tag is provided by the Google Maps API -->
	    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCz3T2t3rfTwN_esxfWWqWQK9DNBOIU7oQ&callback=initMap"
	    async defer></script>
	  </body>
<html>